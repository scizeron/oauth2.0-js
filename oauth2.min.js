var oauth2Utils={guid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},newSessionItem:function(e,t){var o
return o="undefined"!=typeof t?{v:e,t:(new Date).getTime(),l:1e3*t}:{v:e}},getParameter:function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")
var o="[\\#&?/]"+t+"=([^&#]*)",n=new RegExp(o),s=n.exec(e)
return null!=s?s[1]:null},debug:function(e){"undefined"!=typeof console&&console.log(e)},error:function(e){"undefined"!=typeof console&&console.error(e)},setItem:function(e,t){var o=oauth2Utils.newSessionItem(t),n=JSON.stringify(o)
localStorage.setItem(e,n)},getItem:function(e){var t=localStorage.getItem(e)
return null==t?null:JSON.parse(t).v},setSessionItem:function(e,t,o){var n=oauth2Utils.newSessionItem(t,o),s=JSON.stringify(n)
sessionStorage.setItem(e,s)},getSessionItem:function(e){var t,o=sessionStorage.getItem(e)
return null==o?null:(t=JSON.parse(o),"undefined"==typeof t.l?t.v:t.t+t.l>(new Date).getTime()?t.v:(oauth2Utils.debug('"'+e+'" is expired'),oauth2Utils.removeSessionItem(e),null))},removeSessionItem:function(e){sessionStorage.removeItem(e)},clearSession:function(){sessionStorage.clear()},getAccessToken:function(e){return oauth2Utils.getSessionItem(e+".oauth2.accessToken")}},oauth2={getAccessToken:function(e,t,o){var n,s,i,u,a=oauth2Utils.getAccessToken(e),r="session",l=null
if(null==a&&(a=oauth2Utils.getParameter(window.location,"access_token"),r="request"),null==a)return oauth2Utils.debug("no session/request access_token"),u=oauth2Utils.getParameter(window.location,"error"),null!=u&&(oauth2Utils.debug("error parameter detected : "+u),"undefined"!=typeof o&&(i=oauth2Utils.getParameter(window.location,"error_description"),o(null!=i?i:u))),null
if(oauth2Utils.debug("use access_token from "+r+" : "+a),"request"==r){if(n=oauth2Utils.getParameter(window.location,"state"),s=oauth2Utils.getSessionItem(e+".oauth2.state"),oauth2Utils.removeSessionItem(e+".oauth2.state"),null!=s&&n!=s)return oauth2Utils.error(n+"<> "+s),oauth2Utils.error("The state validation has failed [expected: "+s+", received: "+n+"], it's a security problem !!!"),"undefined"!=typeof o&&(oauth2Utils.debug("Call errorCallback ..."),o("The state check is failed")),null
l=oauth2Utils.getParameter(window.location,"expires_in"),oauth2Utils.setSessionItem(e+".oauth2.accessToken",a,l)}return"undefined"!=typeof t&&(oauth2Utils.debug("Call successCallback ..."),t(a,l)),a},authorize:function(e,t,o,n){var s=oauth2Utils.guid(),i=o+"?client_id="+encodeURIComponent(e)+"&response_type=token&state="+encodeURIComponent(s)+"&redirect_uri="+encodeURIComponent(n)
""!=t?i=i+"&scope="+encodeURIComponent(oauth2Cfg.scopes):oauth2Utils.debug("no scope is requested"),oauth2Utils.setSessionItem(e+".oauth2.state",s),oauth2Utils.debug("---------------------------------------------------------------"),oauth2Utils.debug("  authorize"),oauth2Utils.debug("---------------------------------------------------------------"),oauth2Utils.debug("- request       : "+i),oauth2Utils.debug("- redirect_uri  : "+n),oauth2Utils.debug("---------------------------------------------------------------"),window.location.replace(i)}}
